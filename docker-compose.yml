services:
  # Dashboard
  dashboard:
    image: nginx:alpine
    ports:
      - "8899:80"
    volumes:
      - ./dashboard:/usr/share/nginx/html
      - ./dashboard/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - public_net
      - lab_net

  # SSRF Labs
  ssrf-lab1:
    build: ./ssrf/lab1
    ports:
      - "8081:8081"
    networks:
      - lab_net
      - public_net

  ssrf-lab2:
    build: ./ssrf/lab2
    ports:
      - "8082:8082"
    networks:
      - lab_net
      - public_net

  ssrf-lab3:
    build: ./ssrf/lab3
    ports:
      - "8083:8083"
    networks:
      - lab_net
      - public_net

  ssrf-lab4:
    build: ./ssrf/lab4
    ports:
      - "8084:8084"
    networks:
      - lab_net
      - public_net

  ssrf-lab5:
    build: ./ssrf/lab5
    ports:
      - "8085:8085"
    networks:
      - lab_net
      - public_net

  ssrf-lab6:
    build: ./ssrf/lab6
    ports:
      - "8086:8086"
    networks:
      - lab_net
      - public_net

  # SSTI Labs
  ssti-lab1:
    build: ./ssti/lab1
    ports:
      - "8087:8087"
    networks:
      - public_net

  ssti-lab2:
    build: ./ssti/lab2
    ports:
      - "8088:8088"
    networks:
      - public_net

  ssti-lab3:
    build: ./ssti/lab3
    ports:
      - "8089:8089"
    networks:
      - public_net

  # CSTI Labs
  csti-lab1:
    build: ./csti/lab1
    ports:
      - "8090:8090"
    networks:
      - public_net

  csti-lab2:
    build: ./csti/lab2
    ports:
      - "8091:8091"
    networks:
      - public_net

  csti-lab3:
    build: ./csti/lab3
    ports:
      - "8092:8092"
    networks:
      - public_net

  # SQLi Labs
  sqli-lab1:
    build: ./sqli/lab1
    ports:
      - "9001:9001"
    networks:
      - public_net

  sqli-lab2:
    build: ./sqli/lab2
    ports:
      - "9002:9002"
    networks:
      - public_net

  sqli-lab3:
    build: ./sqli/lab3
    ports:
      - "9003:9003"
    networks:
      - public_net

  # XSS Labs
  xss-lab1:
    build: ./xss/lab1
    ports:
      - "9101:9101"
    networks:
      - public_net

  xss-lab2:
    build: ./xss/lab2
    ports:
      - "9102:9102"
    networks:
      - public_net

  xss-lab3:
    build: ./xss/lab3
    ports:
      - "9103:9103"
    networks:
      - public_net

  # Command Injection Labs
  cmd-lab1:
    build: ./cmd-injection/lab1
    ports:
      - "9201:9201"
    networks:
      - public_net

  cmd-lab2:
    build: ./cmd-injection/lab2
    ports:
      - "9202:9202"
    networks:
      - public_net

  cmd-lab3:
    build: ./cmd-injection/lab3
    ports:
      - "9203:9203"
    networks:
      - public_net

  # Internal Services (Targets for SSRF)
  internal-admin:
    build: ./internal-services/admin
    networks:
      - lab_net

  internal-metadata:
    build: ./internal-services/metadata
    networks:
      lab_net:
        ipv4_address: 169.254.169.254

  redis:
    image: redis:alpine
    networks:
      - lab_net

  mysql-db:
    image: mariadb:10.11
    environment:
      - MARIADB_ALLOW_EMPTY_ROOT_PASSWORD=yes
    networks:
      - public_net

networks:
  public_net:
  lab_net:
    internal: true
    ipam:
      config:
        - subnet: 169.254.0.0/16
